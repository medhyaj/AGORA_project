# Executing modified version of Daikon Docker image
The files generated by Beet are used as input to [Daikon](https://plse.cs.washington.edu/daikon/) to detect invariants that, once confirmed by a developer, can be used as test oracles. We recommend using the modified version of Daikon presented in our paper instead of the default one. 

This version of Daikon has been modified based on an analysis of a systematically collected dataset of 40 APIs (+700 operations) and its precision outperforms the one achieved by the default version of Daikon by a margin of more than 30% (in the context of REST APIs). This version of Daikon supports a total of 105 different types of invariants. 

Please refer to our Wiki for a complete list of the [modifications performed on Daikon](https://github.com/isa-group/Beet/wiki/Modified-version-of-Daikon#modifications-on-daikon) and a [taxonomy of the supported invariants](https://github.com/isa-group/Beet/wiki/Modified-version-of-Daikon#invariants-taxonomy).

The source code of our modified version of Daikon can be found [here](https://github.com/JuanCarlosAlonsoValenzuela/daikon_modified). However, we recommend using the Docker image that we provide for an easier installation. 
[The official Daikon documentation](https://plse.cs.washington.edu/daikon/download/doc/) describes how to install and configure Daikon without using our image.

1.	First, we need to pull the image containing the modified version of Daikon:

```
docker pull javalenzuela/daikon_agora
```

2.	Next, we execute the container by specifying the absolute path of the folder containing the declaration and data trace files.

```
docker run --rm -v C:\pathToFolderContainingFilesInHost:/files javalenzuela/daikon_agora java -jar daikon_modified.jar /files/declsFile.decls /files/dtraceFile.dtrace > invariants.csv
```

For instance, if the folder `C:\myUser\instrumentation` contains the declaration and data trace files (and they are named `declsFile.decls` and `dtraceFile.dtrace`):

```
docker run --rm -v C:\myUser\instrumentation:/files javalenzuela/daikon_agora java -jar daikon_modified.jar /files/declsFile.decls /files/dtraceFile.dtrace > invariants.csv
```

This will result in a file in csv format  (as the one in the snippet below) containing the invariants detected in each program point. The [Daikon container configuration options](#daikon-container-configuration-options) section describes the available configuration options when running this version of Daikon, such as the possibility of automatically discarding invariants of the Arithmetic 
comparisons category, which are the main cause behind the false positives reported by AGORA (according to the evaluation conducted in our paper).

```
/albums/{id}/tracks&getAlbumTracks&200&items&artists():::EXIT;LENGTH(return.href)==57;daikon.inv.unary.string.FixedLengthString;(return.href)
/albums/{id}/tracks&getAlbumTracks&200&items&artists():::EXIT;return.href is Url;daikon.inv.unary.string.IsUrl;(return.href)
/albums/{id}/tracks&getAlbumTracks&200&items&artists():::EXIT;LENGTH(return.id)==22;daikon.inv.unary.string.FixedLengthString;(return.id)
/albums/{id}/tracks&getAlbumTracks&200&items&artists():::EXIT;return.type == "artist";daikon.inv.unary.string.OneOfString;(return.type)
/albums/{id}/tracks&getAlbumTracks&200&items&artists():::EXIT;LENGTH(return.type)==6;daikon.inv.unary.string.FixedLengthString;(return.type)
/albums/{id}/tracks&getAlbumTracks&200&items&artists():::EXIT;LENGTH(return.uri)==37;daikon.inv.unary.string.FixedLengthString;(return.uri)
/albums/{id}/tracks&getAlbumTracks&200&items&artists():::EXIT;return.id is a substring of return.href;daikon.inv.binary.twoString.StdString$SubString;(return.href, return.id)
...
```

# Daikon container configuration options
This section describes the flags and configuration options available when running the provided Docker image containing our modified Daikon version.

- **`use_modified_daikon_version`** (default: `true`): If true, the invariants will be detected using the modified version of Daikon proposed in our paper. If false, it will use the default version of Daikon, except for [13 types of invariants that were suppressed](https://github.com/isa-group/Beet/wiki/Modified-version-of-Daikon#invariants-disabled-in-the-default-daikon-configuration) to avoid a combinatorial explosion of reported invariants.
- **`suppress_input_invariants`** (default: `true`): If true, the invariants that only affect input variables will not be reported.
- **`suppress_arithmetic_comparisons`** (default: `false`): If true, the invariant of the Arithmetic comparisons category will not be reported.
- **`suppress_string_comparisons`** (default: `false`): If true, the invariant of the String comparisons category will not be reported.
- **`suppress_specific_formats`** (default: `false`): If true, the invariant of the Specific formats category will not be reported.
- **`suppress_specific_values`** (default: `false`): If true, the invariant of the Specific values category will not be reported.
- **`suppress_array_properties`** (default: `false`): If true, the invariant of the Array properties category will not be reported.

For instance, to run our modified version of Daikon suppressing the invariants of the Arithmetic comparisons category, we use the following command:

```
docker run --rm -v C:\myUser\instrumentation:/files java -jar javalenzuela/daikon_modified.jar /files/declsFile.decls /files/dtraceFile.dtrace suppress_arithmetic_comparisons=true > invariants_without_arithmetic_comparisons.csv
```